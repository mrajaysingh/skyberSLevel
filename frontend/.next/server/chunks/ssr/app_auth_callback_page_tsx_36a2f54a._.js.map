{"version":3,"sources":["turbopack:///[project]/app/auth/callback/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, Suspense } from \"react\";\nimport { useRouter, useSearchParams } from \"next/navigation\";\n\nfunction AuthCallbackContent() {\n  const router = useRouter();\n  const searchParams = useSearchParams();\n  const apiUrl = process.env.NEXT_PUBLIC_API_URL || \"http://localhost:3001\";\n\n  useEffect(() => {\n    const sessionToken = searchParams.get(\"sessionToken\");\n    const refreshToken = searchParams.get(\"refreshToken\");\n    const role = searchParams.get(\"role\");\n\n    if (!sessionToken) {\n      router.replace(\"/login?error=missing_token\");\n      return;\n    }\n\n    const handleAuth = async () => {\n      try {\n        // Store tokens\n        localStorage.setItem(\"sessionToken\", sessionToken);\n        if (refreshToken) {\n          localStorage.setItem(\"refreshToken\", refreshToken);\n        }\n\n        // Verify token and fetch user details\n        const res = await fetch(`${apiUrl}/api/auth/verify`, {\n          method: \"GET\",\n          headers: {\n            Authorization: `Bearer ${sessionToken}`,\n          },\n        });\n\n        if (!res.ok) {\n          throw new Error(\"Token verification failed\");\n        }\n\n        // Check if response is JSON before parsing\n        const contentType = res.headers.get(\"content-type\");\n        if (!contentType || !contentType.includes(\"application/json\")) {\n          throw new Error(\"Response is not JSON\");\n        }\n\n        const data = await res.json();\n\n        // Persist minimal user data for the app\n        if (data && data.success && data.data?.user) {\n          localStorage.setItem(\"userData\", JSON.stringify(data.data.user));\n          localStorage.setItem(\"skyber_authenticated\", \"true\");\n\n          // Redirect based on role\n          const redirectPath = sessionStorage.getItem(\"skyber_redirect_after_login\");\n          sessionStorage.removeItem(\"skyber_redirect_after_login\");\n\n          if (redirectPath) {\n            router.replace(redirectPath);\n          } else if (role === \"super-admin\" || data.data.user.role === \"super-admin\") {\n            router.replace(\"/auth/dashboards/user/super-admin\");\n          } else {\n            router.replace(\"/\");\n          }\n        } else {\n          router.replace(\"/login?error=invalid_session\");\n        }\n      } catch (e) {\n        console.error(\"OAuth callback error:\", e);\n        // Clean up on error\n        localStorage.removeItem(\"sessionToken\");\n        localStorage.removeItem(\"refreshToken\");\n        localStorage.removeItem(\"userData\");\n        localStorage.removeItem(\"skyber_authenticated\");\n        router.replace(\"/login?error=oauth_failed\");\n      }\n    };\n\n    handleAuth();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [searchParams]);\n\n  return null;\n}\n\nexport default function AuthCallback() {\n  return (\n    <Suspense fallback={null}>\n      <AuthCallbackContent />\n    </Suspense>\n  );\n}\n\n\n"],"names":[],"mappings":"wDAEA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OAEA,SAAS,IACP,IAAM,EAAS,CAAA,EAAA,EAAA,SAAA,AAAS,IAClB,EAAe,CAAA,EAAA,EAAA,eAAA,AAAe,IA2EpC,MAxEA,CAAA,EAAA,EAAA,SAAA,AAAS,EAAC,KACR,IAAM,EAAe,EAAa,GAAG,CAAC,gBAChC,EAAe,EAAa,GAAG,CAAC,gBAChC,EAAO,EAAa,GAAG,CAAC,OAE9B,CAAK,EA+DL,CA/DI,AAKe,UACjB,CANiB,EAMb,CAEF,aAAa,OAAO,CAAC,eAAgB,GACjC,GACF,WADgB,EACH,OAAO,CAAC,eAAgB,GAIvC,IAAM,EAAM,MAAM,MAAM,GAAG,OAAO,gBAAgB,CAAC,aAAE,CACnD,OAAQ,MACR,QAAS,CACP,cAAe,CAAC,OAAO,EAAE,EAAA,CAAc,AACzC,CACF,GAEA,GAAI,CAAC,EAAI,EAAE,CACT,CADW,KACL,AAAI,MAAM,6BAIlB,IAAM,EAAc,EAAI,OAAO,CAAC,GAAG,CAAC,gBACpC,GAAI,CAAC,GAAe,CAAC,EAAY,QAAQ,CAAC,oBACxC,CAD6D,KACvD,AAAI,MAAM,wBAGlB,IAAM,EAAO,MAAM,EAAI,IAAI,GAG3B,GAAI,GAAQ,EAAK,OAAO,EAAI,EAAK,IAAI,EAAE,KAAM,CAC3C,aAAa,OAAO,CAAC,WAAY,KAAK,SAAS,CAAC,EAAK,IAAI,CAAC,IAAI,GAC9D,aAAa,OAAO,CAAC,uBAAwB,QAG7C,IAAM,EAAe,eAAe,OAAO,CAAC,+BAC5C,eAAe,UAAU,CAAC,+BAEtB,EACF,EAAO,OAAO,CAAC,EADC,CAEE,gBAAT,GAA0B,AAAwB,eAAe,GAAlC,IAAI,CAAC,IAAI,CAAC,IAAI,CACtD,EAAO,OAAO,CAAC,qCAEf,EAAO,OAAO,CAAC,IAEnB,MACE,CADK,CACE,OAAO,CAAC,+BAEnB,CAAE,MAAO,EAAG,CACV,QAAQ,KAAK,CAAC,wBAAyB,GAEvC,aAAa,UAAU,CAAC,gBACxB,aAAa,UAAU,CAAC,gBACxB,aAAa,UAAU,CAAC,YACxB,aAAa,UAAU,CAAC,wBACxB,EAAO,OAAO,CAAC,4BACjB,EACF,IA5DE,EAAO,OAAO,CAAC,6BAgEnB,EAAG,CAAC,EAAa,EAEV,IACT,CAEe,SAAS,IACtB,MACE,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,QAAQ,CAAA,CAAC,SAAU,cAClB,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,CAAA,IAGP"}