{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/middleware.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport type { NextRequest } from 'next/server';\r\n\r\n/**\r\n * Middleware for mobile device detection, admin domain routing, and redirects\r\n * \r\n * Note: Next.js 16 shows a deprecation warning for middleware, suggesting \"proxy\" instead.\r\n * However, middleware is still the correct approach for redirects and request modifications.\r\n * This warning is informational and does not affect functionality.\r\n */\r\nexport function middleware(request: NextRequest) {\r\n  const { pathname, search, hash } = request.nextUrl;\r\n  const hostname = request.headers.get('host') || '';\r\n  \r\n  // Get URLs from environment variables\r\n  const mobileUrl = process.env.MOBILE_URL || 'm.skyber.dev';\r\n  const mobileHostname = mobileUrl.replace(/^https?:\\/\\//, '').split('/')[0];\r\n  const adminUrl = process.env.ADMIN_URL || 'admin.skyber.dev';\r\n  const adminHostname = adminUrl.replace(/^https?:\\/\\//, '').split('/')[0];\r\n  const mainDomain = 'skyber.dev';\r\n  \r\n  // Skip redirect for localhost\r\n  if (hostname === 'localhost' || hostname.startsWith('127.0.0.1') || hostname.startsWith('localhost:')) {\r\n    return NextResponse.next();\r\n  }\r\n\r\n  // Check if user is on mobile device\r\n  const userAgent = request.headers.get('user-agent') || '';\r\n  const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(userAgent);\r\n  \r\n  // Also check viewport width from headers (if available)\r\n  const viewportWidth = request.headers.get('viewport-width');\r\n  const isMobileByWidth = viewportWidth ? parseInt(viewportWidth) <= 768 : false;\r\n  const isMobileDevice = isMobile || isMobileByWidth;\r\n\r\n  // Check if path is a dashboard/auth route\r\n  const isDashboardRoute = pathname?.startsWith('/auth/dashboards') || pathname?.startsWith('/login');\r\n\r\n  // If user is accessing dashboard routes on main domain, redirect to admin domain\r\n  if (hostname === mainDomain && isDashboardRoute) {\r\n    const redirectBase = adminUrl.startsWith('http') ? adminUrl : `https://${adminUrl}`;\r\n    const redirectUrl = new URL(`${redirectBase}${pathname}${search}${hash || ''}`);\r\n    return NextResponse.redirect(redirectUrl);\r\n  }\r\n\r\n  // If user is on admin domain but not on dashboard routes, redirect to main domain\r\n  if (hostname === adminHostname && !isDashboardRoute) {\r\n    const redirectUrl = new URL(`https://${mainDomain}${pathname}${search}${hash || ''}`);\r\n    return NextResponse.redirect(redirectUrl);\r\n  }\r\n\r\n  // If desktop user is trying to access m.skyber.dev, redirect to main domain\r\n  if (hostname === mobileHostname && !isMobileDevice) {\r\n    const redirectUrl = new URL(`https://${mainDomain}${pathname}${search}${hash || ''}`);\r\n    return NextResponse.redirect(redirectUrl);\r\n  }\r\n\r\n  // If mobile user is on main domain, redirect to mobile domain\r\n  if (hostname === mainDomain && isMobileDevice && !isDashboardRoute) {\r\n    const redirectBase = mobileUrl.startsWith('http') ? mobileUrl : `https://${mobileUrl}`;\r\n    const redirectUrl = new URL(`${redirectBase}${pathname}${search}${hash || ''}`);\r\n    return NextResponse.redirect(redirectUrl);\r\n  }\r\n\r\n  // Allow all other cases\r\n  return NextResponse.next();\r\n}\r\n\r\nexport const config = {\r\n  matcher: [\r\n    /*\r\n     * Match all request paths except for the ones starting with:\r\n     * - api (API routes)\r\n     * - _next/static (static files)\r\n     * - _next/image (image optimization files)\r\n     * - favicon.ico (favicon file)\r\n     */\r\n    '/((?!api|_next/static|_next/image|favicon.ico).*)',\r\n  ],\r\n};\r\n\r\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;;AAUO,SAAS,WAAW,OAAoB;IAC7C,MAAM,EAAE,QAAQ,EAAE,MAAM,EAAE,IAAI,EAAE,GAAG,QAAQ,OAAO;IAClD,MAAM,WAAW,QAAQ,OAAO,CAAC,GAAG,CAAC,WAAW;IAEhD,sCAAsC;IACtC,MAAM,YAAY,QAAQ,GAAG,CAAC,UAAU,IAAI;IAC5C,MAAM,iBAAiB,UAAU,OAAO,CAAC,gBAAgB,IAAI,KAAK,CAAC,IAAI,CAAC,EAAE;IAC1E,MAAM,WAAW,QAAQ,GAAG,CAAC,SAAS,IAAI;IAC1C,MAAM,gBAAgB,SAAS,OAAO,CAAC,gBAAgB,IAAI,KAAK,CAAC,IAAI,CAAC,EAAE;IACxE,MAAM,aAAa;IAEnB,8BAA8B;IAC9B,IAAI,aAAa,eAAe,SAAS,UAAU,CAAC,gBAAgB,SAAS,UAAU,CAAC,eAAe;QACrG,OAAO,+SAAY,CAAC,IAAI;IAC1B;IAEA,oCAAoC;IACpC,MAAM,YAAY,QAAQ,OAAO,CAAC,GAAG,CAAC,iBAAiB;IACvD,MAAM,WAAW,iEAAiE,IAAI,CAAC;IAEvF,wDAAwD;IACxD,MAAM,gBAAgB,QAAQ,OAAO,CAAC,GAAG,CAAC;IAC1C,MAAM,kBAAkB,gBAAgB,SAAS,kBAAkB,MAAM;IACzE,MAAM,iBAAiB,YAAY;IAEnC,0CAA0C;IAC1C,MAAM,mBAAmB,UAAU,WAAW,uBAAuB,UAAU,WAAW;IAE1F,iFAAiF;IACjF,IAAI,aAAa,cAAc,kBAAkB;QAC/C,MAAM,eAAe,SAAS,UAAU,CAAC,UAAU,WAAW,CAAC,QAAQ,EAAE,UAAU;QACnF,MAAM,cAAc,IAAI,IAAI,GAAG,eAAe,WAAW,SAAS,QAAQ,IAAI;QAC9E,OAAO,+SAAY,CAAC,QAAQ,CAAC;IAC/B;IAEA,kFAAkF;IAClF,IAAI,aAAa,iBAAiB,CAAC,kBAAkB;QACnD,MAAM,cAAc,IAAI,IAAI,CAAC,QAAQ,EAAE,aAAa,WAAW,SAAS,QAAQ,IAAI;QACpF,OAAO,+SAAY,CAAC,QAAQ,CAAC;IAC/B;IAEA,4EAA4E;IAC5E,IAAI,aAAa,kBAAkB,CAAC,gBAAgB;QAClD,MAAM,cAAc,IAAI,IAAI,CAAC,QAAQ,EAAE,aAAa,WAAW,SAAS,QAAQ,IAAI;QACpF,OAAO,+SAAY,CAAC,QAAQ,CAAC;IAC/B;IAEA,8DAA8D;IAC9D,IAAI,aAAa,cAAc,kBAAkB,CAAC,kBAAkB;QAClE,MAAM,eAAe,UAAU,UAAU,CAAC,UAAU,YAAY,CAAC,QAAQ,EAAE,WAAW;QACtF,MAAM,cAAc,IAAI,IAAI,GAAG,eAAe,WAAW,SAAS,QAAQ,IAAI;QAC9E,OAAO,+SAAY,CAAC,QAAQ,CAAC;IAC/B;IAEA,wBAAwB;IACxB,OAAO,+SAAY,CAAC,IAAI;AAC1B;AAEO,MAAM,SAAS;IACpB,SAAS;QACP;;;;;;KAMC,GACD;KACD;AACH"}}]
}